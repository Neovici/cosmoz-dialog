<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	<title>cosmoz-dialog tests</title>

	<script src="../../webcomponentsjs/webcomponents-lite.js"></script>
	<script src="../../web-component-tester/browser.js"></script>
	<script src="../../test-fixture/test-fixture-mocha.js"></script>

	<link rel="import" href="../../test-fixture/test-fixture.html">
	<link rel="import" href="../../iron-test-helpers/iron-test-helpers.html">

	<link rel="import" href="../cosmoz-dialog2.html">
	<link rel="import" href="../cosmoz-dialog-container.html">

	<custom-style>
		<style is="custom-style">
			/* This will create a new stacking context above the dialog */
			#stackingContext {
				transform: translateX(0);
			}
		</style>
	</custom-style>
</head>
<body>
	<test-fixture id="withoutStackingContext">
		<template>
			<cosmoz-dialog2 with-backdrop>
				<template>
					<p>Dialog</p>
				</template>
			</cosmoz-dialog2>
		</template>
	</test-fixture>
	<test-fixture id="withStackingContext">
		<template>
			<div id="stackingContext">
				<cosmoz-dialog2 with-backdrop>
					<template>
						<p>Dialog</p>
					</template>
				</cosmoz-dialog2>
			</div>
		</template>
	</test-fixture>
	<test-fixture id="basic">
		<template>
			<cosmoz-dialog2 with-backdrop>
				<template>
					<p>Dialog</p>
				</template>
			</cosmoz-dialog2>
		</template>
	</test-fixture>
	<test-fixture id="basicContainer">
		<template>
			<cosmoz-dialog-container></cosmoz-dialog-container>
		</template>
	</test-fixture>
	<script>
		suite('withoutStackingContext', function () {

			test('backdrop is behing dialog', function (done) {
				var dialog = fixture('withoutStackingContext');
				dialog.paperDialog.addEventListener('iron-overlay-opened', function () {
					// Need to wait a bit before checking elements, because
					// backdrop is displayed with animations.
					Polymer.Base.async(function () {

						var dialogSize = dialog.paperDialog.getBoundingClientRect(),
							backdropElementSize = dialog.paperDialog.backdropElement.getBoundingClientRect(),
							expectedDialogElement,
							expectedBackdrop;
						expectedDialogElement = document.elementFromPoint(dialogSize.left + 1, dialogSize.top + 1);
						expectedBackdrop = document.elementFromPoint(dialogSize.left - 1, dialogSize.top - 1);

						assert.equal(dialog.paperDialog, expectedDialogElement);
						assert.equal(dialog.paperDialog.backdropElement, expectedBackdrop);

						done();
					}, 100);
				});
				dialog.open();
			});

		});

		suite('withStackingContext', function () {

			test('backdrop is behing dialog', function (done) {
				var dialog = fixture('withStackingContext').children[0];
				dialog.paperDialog.addEventListener('iron-overlay-opened', function () {
					// Need to wait a bit before checking elements, because
					// backdrop is displayed with animations.
					Polymer.Base.async(function () {

						var dialogSize = dialog.paperDialog.getBoundingClientRect(),
							backdropElementSize = dialog.paperDialog.backdropElement.getBoundingClientRect(),
							expectedDialogElement,
							expectedBackdrop;
						expectedDialogElement = document.elementFromPoint(dialogSize.left + 1, dialogSize.top + 1);
						expectedBackdrop = document.elementFromPoint(dialogSize.left - 1, dialogSize.top - 1);

						assert.equal(dialog.paperDialog, expectedDialogElement);
						assert.equal(dialog.paperDialog.backdropElement, expectedBackdrop);

						done();
					}, 100);
				});
				dialog.open();
			});

		});

		suite('container', function (){
			var container,
				dialog;

			setup(function (done){
				container = fixture('basicContainer');
				dialog = fixture('basic');
				flush(done);
			});

			test('has container', function (done) {
				assert.equal(dialog._container, container);
				dialog.paperDialog.addEventListener('iron-overlay-opened', function () {
					assert.equal(dialog.paperDialog.parentNode, container);
					done();
				});
				dialog.open();
			});

		});
		</script>
	</body>
</html>
